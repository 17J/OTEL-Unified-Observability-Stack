# Full production-grade Alertmanager routing rules
alertmanager:
  config:
    global: {}

    receivers:
      - name: "null"

      - name: "slack-notifications"
        slack_configs:
          - channel: "#alerts-devops"
            api_url: "{SLACK_WEBHOOK_URL}"
            send_resolved: true
            title: "[{{ .Status | toUpper }}] - {{ .CommonLabels.alertname }}"
            text: |
              *Severity:* {{ .CommonLabels.severity }}
              *Summary:* {{ .CommonLabels.summary }}

      - name: "pagerduty-critical"
        pagerduty_configs:
          - service_key: "{PAGERDUTY_INTEGRATION_KEY}"
            send_resolved: true
            severity: "critical"

    route:
      group_by: ["alertname", "cluster", "service"]
      receiver: "null"
      group_wait: 30s
      group_interval: 5m
      repeat_interval: 4h

      routes:
        - match:
            severity: "critical"
          receiver: "pagerduty-critical"
          group_wait: 5s
          group_interval: 1m

        - matchers:
            - severity =~ "warning|info"
          receiver: "slack-notifications"
